# 读书笔记 - 图解 HTTP（一）

绝大部分 Web 服务构建与 HTTP 协议之上，因此 HTTP 协议内容也早已与当前 Web 服务的特点密不可分，了解 HTTP 的同时也要了解整个 Web 服务的构成。

## 网络基础

了解 HTTP 所需的 TCP/IP 概要

### TCP/IP 协议族

网络设备要相互通信须要遵守相同的规则，规则涉及到通信过程的方方面面，称作协议（protocal）。互联网相关的各类协议集合起来总称为 TCP/IP 协议族

#### 分层管理

TCP/IP 协议族按层次划分为 4 层：

-   应用层：应用层决定向用户提供服务时的通信活动，如 FTP、DNS、HTTP
-   传输层：提供网络间设备的数据传输，如 TCP、UDP
-   网络层：处理网络中流动的数据包
-   数据链路层：连接网络的硬件部分

#### 通信传输流

按照分层顺序，发送端从应用层往下走，接收端从链路层往上走。发送端层与层传输数据时，每经过一层都会打上该层所属的首部信息，反之，接收端层与层之间传输则会把对应的首部消去，这种把数据信息包装起来的方法称为封装（encapsulate）。

### IP

IP 的作用时把数据包传送给对方。保证传送给对方需要满足各类条件，比较重要的两个是 IP 地址和 MAC 地址。

### TCP

TCP 提供可靠的字节流服务（Byte Stream Service）。为了方便传输，把大块数据分割成以报文（segment）为单位的数据包进行管理，并且能够确认数据最终是否送达对方。
为了确认数据准确送达，TCP 采用三次握手策略（three-way handshake）。握手中使用了 TCP 的标志 SYN（synchronize）和 ACK（acknowledgement）。握手过程如下：

-   发送端发送带 SYN 标志的数据包
-   接收端回传带 SYN/ACK 标志的数据包以示确认
-   发送端回传带 ACK 标志的数据包代表结束

（为什么一定是 3 次，不能是 2 次或者 4 次？）

### DNS

DNS 负责域名解析，通过域名查到 IP 地址，或者逆向从 IP 查到域名。

### URI

URI 用于标识某一互联网资源，URL 则表示资源所处的位置。URL 是 URI 的子集，不过在充分理解的基础上也可用 URL 替换 URI。
以 _http://user:pass@www.example.com:80/dir/index.html?uid=1#ch1_ 为例 URI 格式如下：

-   协议方案名 `http://`
-   登录信息（认证）`user:pass`
-   服务器地址 `www.example.com`
-   服务器端口号 `80`
-   带层次的文件路径 `dir/index.html`
-   查询字符串 `uid=1`
-   片段标识符 `ch1`

## HTTP 协议内容

### 通信过程

HTTP 协议服务于客户端和服务端之间，请求必定由客户端发出，服务端响应该请求并返回。

### 报文

用于 HTTP 协议交换的信息称为 HTTP 报文，分别有客户端发出的请求报文和服务端的响应报文。

-   报文首部 服务端或客户端需处理的请求或响应的内容及属性
-   空行（CR+LF）第一个出现的空行划分首部和主体
-   报文主体 应被发送的数据

通常，并不一定要有报文主体。
请求报文和响应报文首部：

-   请求行 包含请求方法，请求 URI，HTTP 版本
-   状态行 包含响应结果的状态吗，原因短语，HTTP 版本
-   首部字段 包含请求和响应各种条件的各类首部
-   其他 可能包含 HTTP 的 RFC 里未定义的首部（Cookie 等）

### 请求方法

请求方法用于告知服务端请求的意图，可以指定请求的资源按期望产生某种行为。

-   GET：获取资源
-   POST：传输实体主体
-   PUT：传输文件
-   HEAD：获得报文首部
-   DELETE：删除文件
-   OPTIONS：询问支持的方法
-   TRACE：追踪路径
-   CONNECT：要求用隧道协议连接代理

注意方法名区分大小写。
由于 HTTP/1.1 的 PUT 和 DELETE 方法不带验证机制，存在安全性问题，一般的 Web 网站不使用该方法。若配合 Web 应用验证机制，或架构设计采用 REST 标准或有可能开放使用。

### 状态码

状态码负责表示客户端 HTTP 请求的返回结果、标记服务器端的处理是否正常、通知出现的错误等工作。

-   2XX 成功

    -   200 OK
    -   204 No Content
    -   206 Partial Content

-   3XX 重定向

    -   301 Moved Permanently
    -   302 Found
    -   303 See Other
    -   304 Not Modified
    -   307 Temporary Redirect

-   4XX 客户端错误

    -   401 Unauthorized
    -   403 Forbidden
    -   404 Not Found

-   5XX 服务器错误
    -   500 Internal Server Error
    -   503 Service Unavailable

状态码并不一定能反映出真实的状况，比如 Web 应用程序内部发生错误，状态码依然返回 200 OK，这种情况也经常遇到。

### 首部

